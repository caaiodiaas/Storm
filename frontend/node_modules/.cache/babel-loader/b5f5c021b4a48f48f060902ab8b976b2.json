{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\caiod\\\\OneDrive\\\\Documentos\\\\GitHub\\\\storm\\\\frontend-storm\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\caiod\\\\OneDrive\\\\Documentos\\\\GitHub\\\\storm\\\\frontend-storm\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport { Transformers } from '@supabase/realtime-js';\nexport var SupabaseRealtimeClient = /*#__PURE__*/function () {\n  function SupabaseRealtimeClient(socket, headers, schema, tableName) {\n    _classCallCheck(this, SupabaseRealtimeClient);\n\n    var chanParams = {};\n    var topic = tableName === '*' ? \"realtime:\".concat(schema) : \"realtime:\".concat(schema, \":\").concat(tableName);\n    var userToken = headers['Authorization'].split(' ')[1];\n\n    if (userToken) {\n      chanParams['user_token'] = userToken;\n    }\n\n    this.subscription = socket.channel(topic, chanParams);\n  }\n\n  _createClass(SupabaseRealtimeClient, [{\n    key: \"getPayloadRecords\",\n    value: function getPayloadRecords(payload) {\n      var records = {\n        new: {},\n        old: {}\n      };\n\n      if (payload.type === 'INSERT' || payload.type === 'UPDATE') {\n        records.new = Transformers.convertChangeData(payload.columns, payload.record);\n      }\n\n      if (payload.type === 'UPDATE' || payload.type === 'DELETE') {\n        records.old = Transformers.convertChangeData(payload.columns, payload.old_record);\n      }\n\n      return records;\n    }\n    /**\n     * The event you want to listen to.\n     *\n     * @param event The event\n     * @param callback A callback function that is called whenever the event occurs.\n     */\n\n  }, {\n    key: \"on\",\n    value: function on(event, callback) {\n      var _this = this;\n\n      this.subscription.on(event, function (payload) {\n        var enrichedPayload = {\n          schema: payload.schema,\n          table: payload.table,\n          commit_timestamp: payload.commit_timestamp,\n          eventType: payload.type,\n          new: {},\n          old: {},\n          errors: payload.errors\n        };\n        enrichedPayload = Object.assign(Object.assign({}, enrichedPayload), _this.getPayloadRecords(payload));\n        callback(enrichedPayload);\n      });\n      return this;\n    }\n    /**\n     * Enables the subscription.\n     */\n\n  }, {\n    key: \"subscribe\",\n    value: function subscribe() {\n      var callback = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n      this.subscription.onError(function (e) {\n        return callback('SUBSCRIPTION_ERROR', e);\n      });\n      this.subscription.onClose(function () {\n        return callback('CLOSED');\n      });\n      this.subscription.subscribe().receive('ok', function () {\n        return callback('SUBSCRIBED');\n      }).receive('error', function (e) {\n        return callback('SUBSCRIPTION_ERROR', e);\n      }).receive('timeout', function () {\n        return callback('RETRYING_AFTER_TIMEOUT');\n      });\n      return this.subscription;\n    }\n  }]);\n\n  return SupabaseRealtimeClient;\n}();","map":null,"metadata":{},"sourceType":"module"}